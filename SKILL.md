---
name: grid-lol-data-fetcher
description: Fetch and process League of Legends professional match data from the GRID Open Access API. Use this skill when querying LoL esports series data, extracting draft picks/bans, player statistics, or preparing data for draft analysis and machine learning applications.
---

# GRID LoL Series Data Fetcher Skill

Fetch, process, and structure League of Legends professional match data from the GRID Open Access API for analytics, draft analysis, and machine learning applications.

## Overview

This skill provides a complete methodology for:
1. Querying the GRID GraphQL API for LoL esports series data
2. Extracting and normalizing entities (teams, players, champions, games, drafts)
3. Generating structured CSV/JSON outputs aligned with common analytics schemas
4. Handling rate limits, resumable progress, and error recovery

## Quick Start

```bash
# Check current progress
python fetch_lol_series_v3.py --status

# Fetch all series from CSV (API key required)
python fetch_lol_series_v3.py --api-key YOUR_API_KEY

# Fetch specific series IDs
python fetch_lol_series_v3.py --api-key YOUR_API_KEY --series 2847564,2847565,2849603

# Fetch first N series from CSV
python fetch_lol_series_v3.py --api-key YOUR_API_KEY --limit 100

# Use environment variable for API key
export GRID_API_KEY=YOUR_API_KEY
python fetch_lol_series_v3.py --series 2847564,2847565

# Reset all progress and start fresh
python fetch_lol_series_v3.py --reset

# Export all fetched data to CSVs
python fetch_lol_series_v3.py --export
```

## API Configuration

| Setting | Value |
|---------|-------|
| **Endpoint** | `https://api-op.grid.gg/live-data-feed/series-state/graphql` |
| **Auth** | Header `x-api-key: <API_KEY>` (required via `--api-key` or `GRID_API_KEY` env var) |
| **Rate Limit** | 20 requests/minute |
| **Delay** | 3.1 seconds between requests |
| **Timeout** | 30 seconds per request |

## CLI Options

| Option | Description |
|--------|-------------|
| `--api-key KEY` | API key for GRID API (required for fetching, or set `GRID_API_KEY` env var) |
| `--series IDS` | Comma-separated list of specific series IDs to fetch |
| `--limit N` | Fetch first N series from CSV |
| `--input FILE` | Use custom input CSV file |
| `--batch-size N` | Progress update frequency (default: 50) |
| `--status` | Show current progress status |
| `--reset` | Clear all progress and start fresh |
| `--export` | Export fetched data to CSVs |

## Input Requirements

The script expects a CSV file with a `SeriesID` column:

```csv
SeriesID,Started,Finished,GameNumber,TeamID,TeamName,TeamWon
2618418,TRUE,TRUE,1,52661,Team BDS,FALSE
2618419,TRUE,TRUE,1,353,SK Gaming,TRUE
```

Default path: `/mnt/user-data/uploads/LoLSeriesGames_2024_2025.csv`

## Output Files

### Directory Structure

```
/mnt/user-data/outputs/
├── grid_data/
│   ├── progress.json              # Tracks completed/failed series
│   ├── fetch.log                  # Detailed timestamped log
│   └── batches/
│       ├── series_2616371.json    # Individual series data
│       ├── series_2616372.json
│       └── ...
├── teams.csv                      # Generated by --export
├── players.csv
├── champions.csv
├── series.csv
├── games.csv
├── draft_actions.csv
└── player_game_stats.csv
```

### CSV Schemas

#### teams.csv
| Column | Type | Description |
|--------|------|-------------|
| id | TEXT | GRID team ID |
| name | TEXT | Team display name |

#### players.csv
| Column | Type | Description |
|--------|------|-------------|
| id | TEXT | GRID player ID |
| name | TEXT | Player IGN |
| team_id | TEXT | Most recent team ID |
| team_name | TEXT | Most recent team name |

#### champions.csv
| Column | Type | Description |
|--------|------|-------------|
| id | TEXT | GRID champion UUID |
| name | TEXT | Champion name |

#### series.csv
| Column | Type | Description |
|--------|------|-------------|
| id | TEXT | GRID series ID |
| tournament_id | TEXT | Tournament ID (null - not in API) |
| blue_team_id | TEXT | Blue side team ID |
| red_team_id | TEXT | Red side team ID |
| format | TEXT | best-of-1, best-of-3, best-of-5 |
| match_date | TEXT | ISO 8601 timestamp |
| started | BOOL | Series started |
| finished | BOOL | Series finished |
| schema_version | TEXT | GRID schema version |

#### games.csv
| Column | Type | Description |
|--------|------|-------------|
| id | TEXT | GRID game UUID |
| series_id | TEXT | Parent series ID |
| game_number | INT | Game number in series (1, 2, 3...) |
| winner_team_id | TEXT | Winning team ID |
| duration_seconds | INT | Game duration |
| patch_version | TEXT | Game patch (v3.12+) |

#### draft_actions.csv
| Column | Type | Description |
|--------|------|-------------|
| game_id | TEXT | Parent game ID |
| series_id | TEXT | Parent series ID |
| sequence_number | INT | Draft order (1-20) |
| action_type | TEXT | "ban" or "pick" |
| team_id | TEXT | Acting team ID |
| champion_id | TEXT | Champion UUID |
| champion_name | TEXT | Champion name |

**Draft Sequence (Standard LoL Pro Draft):**
```
Ban Phase 1:  1-6   (alternating, blue first)
Pick Phase 1: 7-12  (B-R-R-B-B-R)
Ban Phase 2:  13-16 (alternating, red first)
Pick Phase 2: 17-20 (R-B-B-R)
```

#### player_game_stats.csv
| Column | Type | Description | Min Version |
|--------|------|-------------|-------------|
| game_id | TEXT | Game ID | v3.0+ |
| series_id | TEXT | Series ID | v3.0+ |
| player_id | TEXT | Player ID | v3.0+ |
| player_name | TEXT | Player IGN | v3.0+ |
| team_id | TEXT | Team ID | v3.0+ |
| team_side | TEXT | "blue" or "red" | v3.0+ |
| team_won | BOOL | Did team win | v3.0+ |
| champion_id | TEXT | Champion UUID | v3.0+ |
| champion_name | TEXT | Champion name | v3.0+ |
| role | TEXT | TOP/JNG/MID/ADC/SUP | Inferred from champion |
| kills | INT | Player kills | v3.0+ |
| deaths | INT | Player deaths | v3.0+ |
| assists | INT | Player assists | v3.0+ |
| kda_ratio | FLOAT | (K+A)/max(D,1) | v3.27+ (calculated otherwise) |
| kill_participation | FLOAT | % of team kills | v3.35+ (calculated otherwise) |
| damage_dealt | INT | Total damage | v3.23+ |
| experience_points | INT | Total XP | v3.23+ |
| vision_score | FLOAT | Ward score | v3.30+ |
| first_kill | BOOL | Got first blood | v3.10+ |
| team_first_kill | BOOL | Team got first blood | v3.10+ |

## Schema Version Handling

The GRID API uses schema versioning. The script automatically detects each series' version and uses the appropriate query to extract maximum available data.

| Field | Min Version | Notes |
|-------|-------------|-------|
| Basic K/D/A | v3.0+ | All series |
| `firstKill` | v3.10+ | Team and player level |
| `titleVersion` (patch) | v3.12+ | e.g., "14.22", "15.1" |
| `damageDealt` | v3.23+ | Total damage dealt |
| `experiencePoints` | v3.23+ | Total XP earned |
| `kdaRatio` | v3.27+ | Pre-calculated by API |
| `visionScore` | v3.30+ | Ward score |
| `killParticipation` | v3.35+ | As percentage |

## Time Estimates

| Series Count | Estimated Time | Notes |
|--------------|----------------|-------|
| 20 | 2 min | Version check + data fetch per series |
| 100 | 10 min | |
| 500 | 50 min | |
| 1,488 | 2.5 hours | Full dataset |

Formula: `(series_count × 2 calls × 3 seconds) / 60 = minutes`

## Progress & Resumption

The script saves progress after every series:

```json
{
  "completed": {
    "2616371": "/path/to/series_2616371.json",
    "2616372": "/path/to/series_2616372.json"
  },
  "failed": {
    "2616500": "Could not fetch version"
  },
  "started_at": "2026-01-21T14:55:26",
  "last_updated": "2026-01-21T15:30:00",
  "version_stats": {
    "v3.1": 50,
    "v3.30": 100,
    "v3.47": 25
  }
}
```

**To resume:** Just run the script again - it automatically skips completed series.

**To start fresh:** Run `python fetch_lol_series_v3.py --reset`

**To check progress:** Run `python fetch_lol_series_v3.py --status`

## Error Handling

| Error | Cause | Handling |
|-------|-------|----------|
| `UNAUTHENTICATED` | Invalid/missing API key | Check API key |
| `PERMISSION_DENIED` | Series not in Open Access | Logged as failed, skipped |
| `only available from version X.Y` | Schema version mismatch | Auto-handled by version detection |
| `429 Too Many Requests` | Rate limit exceeded | Script enforces 3.1s delay |
| Network timeout | Connection issues | Logged as failed, continues |

## Champion Icon Mapping

The `riot_key` is a Data Dragon identifier for fetching champion icons (NOT an API key).

Use the included `references/grid_to_riot_key.json` mapping:

```python
import json

# Load mapping
with open('references/grid_to_riot_key.json') as f:
    grid_to_riot = json.load(f)

# Get icon URL
champion_name = "Kai'Sa"  # From GRID API
riot_key = grid_to_riot.get(champion_name, champion_name)  # "Kaisa"
icon_url = f"https://ddragon.leagueoflegends.com/cdn/15.1.1/img/champion/{riot_key}.png"
```

## Files in This Skill

```
grid-lol-data-skill/
├── SKILL.md                        # This documentation
├── scripts/
│   ├── fetch_lol_series_v3.py      # Main fetcher script
│   └── fetch_datadragon.py         # Champion icon mapping fetcher
├── references/
│   ├── schema_mapping.md           # Field mappings and data types
│   ├── draft_sequence.md           # LoL draft phase documentation
│   ├── champion_roles.json         # Champion-to-role mappings
│   └── grid_to_riot_key.json       # GRID name to Data Dragon key
└── examples/
    ├── sample_output/              # Example CSV outputs
    └── curl_examples.sh            # cURL command examples
```

## Usage Examples

### Example 1: Fetch Specific Series

```bash
# Fetch just a few specific series
python fetch_lol_series_v3.py --api-key YOUR_KEY --series 2847564,2847565,2849603
```

### Example 2: Full Dataset Fetch

```bash
# 1. Check if any previous progress exists
python fetch_lol_series_v3.py --status

# 2. Start or resume fetching
python fetch_lol_series_v3.py --api-key YOUR_KEY

# 3. If interrupted, just run again to resume
python fetch_lol_series_v3.py --api-key YOUR_KEY

# 4. When complete, export to CSVs
python fetch_lol_series_v3.py --export
```

### Example 3: Test Run

```bash
# Fetch only first 20 series to test
python fetch_lol_series_v3.py --api-key YOUR_KEY --limit 20

# Check what was fetched
python fetch_lol_series_v3.py --status

# Export test data
python fetch_lol_series_v3.py --export
```

### Example 4: Fresh Start

```bash
# Clear all previous data
python fetch_lol_series_v3.py --reset

# Start fetching from scratch
python fetch_lol_series_v3.py --api-key YOUR_KEY
```

### Example 5: Custom Processing

```python
from pathlib import Path
import json

# Load individual series files
batches_dir = Path("/mnt/user-data/outputs/grid_data/batches")
for series_file in batches_dir.glob("series_*.json"):
    with open(series_file) as f:
        data = json.load(f)
    
    series = data["data"]["seriesState"]
    print(f"Series {series['id']}: {series.get('format')}")
    
    for game in series.get("games", []):
        for action in game.get("draftActions", []):
            if action["type"] == "pick":
                print(f"  Pick: {action['draftable']['name']}")
```

## Fields Not Available in GRID Open Access API

These fields are in the hackathon schema but not available:

```
- tournament_id (series) - Not in API response
- gold_earned (player stats) - Not exposed in Open Access
- cs / creep score (player stats) - Not exposed in Open Access
```

## Extending This Skill

### Adding New Output Fields
1. Check if field exists in GRID API schema for target version
2. Add field to appropriate query in `QUERIES` dict
3. Update `extract_and_export()` to capture the new field
4. Add column to the appropriate CSV fieldnames list
---
name: grid-lol-data-fetcher
description: Fetch and process League of Legends professional match data from the GRID Open Access API. Use when working with LoL esports data, GRID API, pro match statistics, draft picks/bans, player KDA stats, or downloading esports datasets for analytics and ML applications.
---

# GRID LoL Series Data Fetcher Skill

Fetch, process, and structure League of Legends professional match data from the GRID Open Access API for analytics, draft analysis, and machine learning applications.

## Overview

This skill provides a complete methodology for:
1. Querying the GRID GraphQL API for LoL esports series data
2. Extracting and normalizing entities (teams, players, champions, games, drafts)
3. Generating structured CSV/JSON outputs aligned with common analytics schemas
4. Handling rate limits, resumable progress, and error recovery

## Quick Start

```bash
# Fetch specific series IDs (creates a new timestamped run)
python fetch_lol_series_v3.py --api-key YOUR_API_KEY --series 2847564,2847565,2849603

# Fetch from CSV file with limit
python fetch_lol_series_v3.py --api-key YOUR_API_KEY --input series.csv --limit 100

# Create a named run for organization
python fetch_lol_series_v3.py --api-key YOUR_API_KEY --run "lec_spring_2025" --input series.csv

# Continue the most recent run (if interrupted)
python fetch_lol_series_v3.py --api-key YOUR_API_KEY --run latest

# List all runs
python fetch_lol_series_v3.py --list-runs

# Check status of a run
python fetch_lol_series_v3.py --status --run latest

# Export run data to CSVs
python fetch_lol_series_v3.py --export --run latest

# Use environment variable for API key
export GRID_API_KEY=YOUR_API_KEY
python fetch_lol_series_v3.py --series 2847564,2847565

# Custom output directory
python fetch_lol_series_v3.py --output /path/to/data --api-key KEY --series 123,456
```

## API Configuration

| Setting | Value |
|---------|-------|
| **Endpoint** | `https://api-op.grid.gg/live-data-feed/series-state/graphql` |
| **Auth** | Header `x-api-key: <API_KEY>` (required via `--api-key` or `GRID_API_KEY` env var) |
| **Rate Limit** | 20 requests/minute |
| **Delay** | 3.1 seconds between requests |
| **Timeout** | 30 seconds per request |

## CLI Options

### Run Management
| Option | Description |
|--------|-------------|
| `--output DIR` | Base output directory (default: `./outputs`) |
| `--run NAME` | Run name: `latest` for most recent, or custom name to create/continue |
| `--list-runs` | List all available runs with their status |

### Data Source
| Option | Description |
|--------|-------------|
| `--input FILE` | Input CSV file with `SeriesID` column (required for new runs from CSV) |
| `--series IDS` | Comma-separated list of specific series IDs to fetch |
| `--limit N` | Fetch first N series from CSV |

### Fetching Options
| Option | Description |
|--------|-------------|
| `--api-key KEY` | API key for GRID API (or set `GRID_API_KEY` env var) |
| `--batch-size N` | Progress update frequency (default: 50) |

### Commands
| Option | Description |
|--------|-------------|
| `--status` | Show progress status for a run (requires `--run`) |
| `--reset` | Delete a run and all its data (requires `--run`) |
| `--export` | Export run data to CSVs (requires `--run`) |

### Confirmation Options
| Option | Description |
|--------|-------------|
| `--yes`, `-y` | Skip confirmation prompts (for automation/scripts) |
| `--dry-run` | Show what would happen without executing |

## Input Requirements

The script expects a CSV file with a `SeriesID` column:

```csv
SeriesID,Started,Finished,GameNumber,TeamID,TeamName,TeamWon
2618418,TRUE,TRUE,1,52661,Team BDS,FALSE
2618419,TRUE,TRUE,1,353,SK Gaming,TRUE
```

## Output Files

### Directory Structure

Each fetch creates an isolated run folder to prevent data conflicts:

```
./outputs/                           # Base output directory (configurable via --output)
├── 20260121_143022/                 # Auto-generated timestamp run
│   ├── run_config.json              # Run parameters and metadata
│   ├── progress.json                # Tracks completed/failed series
│   ├── fetch.log                    # Detailed timestamped log
│   ├── raw/                         # Individual API responses
│   │   ├── series_2616371.json
│   │   ├── series_2616372.json
│   │   └── ...
│   └── csv/                         # Generated by --export
│       ├── teams.csv
│       ├── players.csv
│       ├── champions.csv
│       ├── series.csv
│       ├── games.csv
│       ├── draft_actions.csv
│       └── player_game_stats.csv
├── lec_spring_2025/                 # Custom named run (via --run)
│   ├── run_config.json
│   ├── progress.json
│   ├── ...
└── ...
```

### CSV Schemas

#### teams.csv
| Column | Type | Description |
|--------|------|-------------|
| id | TEXT | GRID team ID |
| name | TEXT | Team display name |

#### players.csv
| Column | Type | Description |
|--------|------|-------------|
| id | TEXT | GRID player ID |
| name | TEXT | Player IGN |
| team_id | TEXT | Most recent team ID |
| team_name | TEXT | Most recent team name |

#### champions.csv
| Column | Type | Description |
|--------|------|-------------|
| id | TEXT | GRID champion UUID |
| name | TEXT | Champion name |

#### series.csv
| Column | Type | Description |
|--------|------|-------------|
| id | TEXT | GRID series ID |
| tournament_id | TEXT | Tournament ID (null - not in API) |
| blue_team_id | TEXT | Blue side team ID |
| red_team_id | TEXT | Red side team ID |
| format | TEXT | best-of-1, best-of-3, best-of-5 |
| match_date | TEXT | ISO 8601 timestamp |
| started | BOOL | Series started |
| finished | BOOL | Series finished |
| schema_version | TEXT | GRID schema version |

#### games.csv
| Column | Type | Description |
|--------|------|-------------|
| id | TEXT | GRID game UUID |
| series_id | TEXT | Parent series ID |
| game_number | INT | Game number in series (1, 2, 3...) |
| winner_team_id | TEXT | Winning team ID |
| duration_seconds | INT | Game duration |
| patch_version | TEXT | Game patch (v3.12+) |

#### draft_actions.csv
| Column | Type | Description |
|--------|------|-------------|
| game_id | TEXT | Parent game ID |
| series_id | TEXT | Parent series ID |
| sequence_number | INT | Draft order (1-20) |
| action_type | TEXT | "ban" or "pick" |
| team_id | TEXT | Acting team ID |
| champion_id | TEXT | Champion UUID |
| champion_name | TEXT | Champion name |

**Draft Sequence (Standard LoL Pro Draft):**
```
Ban Phase 1:  1-6   (alternating, blue first)
Pick Phase 1: 7-12  (B-R-R-B-B-R)
Ban Phase 2:  13-16 (alternating, red first)
Pick Phase 2: 17-20 (R-B-B-R)
```

#### player_game_stats.csv
| Column | Type | Description | Min Version |
|--------|------|-------------|-------------|
| game_id | TEXT | Game ID | v3.0+ |
| series_id | TEXT | Series ID | v3.0+ |
| player_id | TEXT | Player ID | v3.0+ |
| player_name | TEXT | Player IGN | v3.0+ |
| team_id | TEXT | Team ID | v3.0+ |
| team_side | TEXT | "blue" or "red" | v3.0+ |
| team_won | BOOL | Did team win | v3.0+ |
| champion_id | TEXT | Champion UUID | v3.0+ |
| champion_name | TEXT | Champion name | v3.0+ |
| role | TEXT | TOP/JNG/MID/ADC/SUP | Inferred from champion |
| kills | INT | Player kills | v3.0+ |
| deaths | INT | Player deaths | v3.0+ |
| assists | INT | Player assists | v3.0+ |
| kda_ratio | FLOAT | (K+A)/max(D,1) | v3.27+ (calculated otherwise) |
| kill_participation | FLOAT | % of team kills | v3.35+ (calculated otherwise) |
| damage_dealt | INT | Total damage | v3.23+ |
| experience_points | INT | Total XP | v3.23+ |
| vision_score | FLOAT | Ward score | v3.30+ |
| first_kill | BOOL | Got first blood | v3.10+ |
| team_first_kill | BOOL | Team got first blood | v3.10+ |

## Schema Version Handling

The GRID API uses schema versioning. The script automatically detects each series' version and uses the appropriate query to extract maximum available data.

| Field | Min Version | Notes |
|-------|-------------|-------|
| Basic K/D/A | v3.0+ | All series |
| `firstKill` | v3.10+ | Team and player level |
| `titleVersion` (patch) | v3.12+ | e.g., "14.22", "15.1" |
| `damageDealt` | v3.23+ | Total damage dealt |
| `experiencePoints` | v3.23+ | Total XP earned |
| `kdaRatio` | v3.27+ | Pre-calculated by API |
| `visionScore` | v3.30+ | Ward score |
| `killParticipation` | v3.35+ | As percentage |

## Time Estimates

| Series Count | Estimated Time | Notes |
|--------------|----------------|-------|
| 20 | 2 min | Version check + data fetch per series |
| 100 | 10 min | |
| 500 | 50 min | |
| 1,488 | 2.5 hours | Full dataset |

Formula: `(series_count × 2 calls × 3 seconds) / 60 = minutes`

## Interactive Confirmation

Before starting a fetch or reset, the script displays a preview and asks for confirmation:

```
═══════════════════════════════════════════════════════════════════
  GRID Data Fetcher - Run Preview
═══════════════════════════════════════════════════════════════════

  Run ID:         20260121_150322 (new)
  Output:         ./outputs/20260121_150322/

  Data Source:    series.csv (limited from 1488)
  Series Count:   100
  Estimated Time: 10.3 minutes

  Output Structure:
    ./outputs/20260121_150322/
    ├── run_config.json
    ├── progress.json
    ├── fetch.log
    ├── raw/
    │   └── series_*.json (100 files)
    └── csv/           (after --export)

═══════════════════════════════════════════════════════════════════
  Options You May Want to Configure:
═══════════════════════════════════════════════════════════════════

  --output DIR     Base output directory (current: ./outputs)
  --run NAME       Custom run name (current: 20260121_150322)
  --limit N        Limit series count (current: 100)
  --batch-size N   Progress frequency (current: 50)

═══════════════════════════════════════════════════════════════════

Start fetching? [Y/n]:
```

- **Enter** or **Y** → proceeds with fetch
- **N** → aborts, allowing you to adjust options
- `--yes` or `-y` → skips confirmation (for automation)
- `--dry-run` → shows preview and exits without executing

## Progress & Resumption

Each run saves progress after every series in `progress.json`:

```json
{
  "completed": {
    "2616371": "./outputs/20260121_143022/raw/series_2616371.json",
    "2616372": "./outputs/20260121_143022/raw/series_2616372.json"
  },
  "failed": {
    "2616500": "Could not fetch version"
  },
  "started_at": "2026-01-21T14:55:26",
  "last_updated": "2026-01-21T15:30:00",
  "version_stats": {
    "v3.1": 50,
    "v3.30": 100,
    "v3.47": 25
  }
}
```

Run configuration is stored in `run_config.json`:

```json
{
  "run_id": "20260121_143022",
  "created_at": "2026-01-21T14:30:22",
  "input_source": "/path/to/series.csv",
  "limit": 100,
  "api_endpoint": "https://api-op.grid.gg/live-data-feed/series-state/graphql"
}
```

**To resume:** `python fetch_lol_series_v3.py --api-key KEY --run latest`

**To check progress:** `python fetch_lol_series_v3.py --status --run latest`

**To list all runs:** `python fetch_lol_series_v3.py --list-runs`

**To delete a run:** `python fetch_lol_series_v3.py --reset --run <run_name>`

## Error Handling

| Error | Cause | Handling |
|-------|-------|----------|
| `UNAUTHENTICATED` | Invalid/missing API key | Check API key |
| `PERMISSION_DENIED` | Series not in Open Access | Logged as failed, skipped |
| `only available from version X.Y` | Schema version mismatch | Auto-handled by version detection |
| `429 Too Many Requests` | Rate limit exceeded | Script enforces 3.1s delay |
| Network timeout | Connection issues | Logged as failed, continues |

## Champion Icon Mapping

The `riot_key` is a Data Dragon identifier for fetching champion icons (NOT an API key).

Use the included `references/grid_to_riot_key.json` mapping:

```python
import json

# Load mapping
with open('references/grid_to_riot_key.json') as f:
    grid_to_riot = json.load(f)

# Get icon URL
champion_name = "Kai'Sa"  # From GRID API
riot_key = grid_to_riot.get(champion_name, champion_name)  # "Kaisa"
icon_url = f"https://ddragon.leagueoflegends.com/cdn/15.1.1/img/champion/{riot_key}.png"
```

## Files in This Skill

```
grid-lol-data-skill/
├── SKILL.md                        # This documentation
├── scripts/
│   ├── fetch_lol_series_v3.py      # Main fetcher script
│   └── fetch_datadragon.py         # Champion icon mapping fetcher
├── references/
│   ├── schema_mapping.md           # Field mappings and data types
│   ├── draft_sequence.md           # LoL draft phase documentation
│   ├── champion_roles.json         # Champion-to-role mappings
│   └── grid_to_riot_key.json       # GRID name to Data Dragon key
└── examples/
    ├── sample_output/              # Example CSV outputs
    └── curl_examples.sh            # cURL command examples
```

## Usage Examples

### Example 1: Fetch Specific Series

```bash
# Fetch specific series (creates timestamped run automatically)
python fetch_lol_series_v3.py --api-key YOUR_KEY --series 2847564,2847565,2849603

# Check the run
python fetch_lol_series_v3.py --status --run latest

# Export to CSVs
python fetch_lol_series_v3.py --export --run latest
```

### Example 2: Named Run for a Tournament

```bash
# Create a named run for LEC Spring 2025
python fetch_lol_series_v3.py --api-key YOUR_KEY --run "lec_spring_2025" \
    --input lec_series.csv

# If interrupted, resume the same run
python fetch_lol_series_v3.py --api-key YOUR_KEY --run "lec_spring_2025"

# When complete, export to CSVs
python fetch_lol_series_v3.py --export --run "lec_spring_2025"
```

### Example 3: Test Run with Limit

```bash
# Fetch only first 20 series to test
python fetch_lol_series_v3.py --api-key YOUR_KEY --input series.csv --limit 20

# Check what was fetched
python fetch_lol_series_v3.py --status --run latest

# Export test data
python fetch_lol_series_v3.py --export --run latest
```

### Example 4: Managing Multiple Runs

```bash
# List all runs
python fetch_lol_series_v3.py --list-runs

# Check status of a specific run
python fetch_lol_series_v3.py --status --run "lec_spring_2025"

# Delete a run you no longer need
python fetch_lol_series_v3.py --reset --run "test_run_20260115"
```

### Example 5: Custom Processing

```python
from pathlib import Path
import json

# Load individual series files from a run
run_dir = Path("./outputs/lec_spring_2025/raw")
for series_file in run_dir.glob("series_*.json"):
    with open(series_file) as f:
        data = json.load(f)

    series = data["data"]["seriesState"]
    print(f"Series {series['id']}: {series.get('format')}")

    for game in series.get("games", []):
        for action in game.get("draftActions", []):
            if action["type"] == "pick":
                print(f"  Pick: {action['draftable']['name']}")
```

## Presenting Results

After a fetch or export completes, provide:

1. **Output directory**: Full path to the run folder (e.g., `./outputs/20260121_150322/`)
2. **Run summary**: Series fetched, success/failure counts, version distribution
3. **Next step**: If fetch completed, suggest `--export` to generate CSVs

Example summary:
```
Run complete: ./outputs/20260121_150322/
- Fetched: 98 series
- Failed: 2 (permission denied)
- Versions: v3.30 (45), v3.35 (40), v3.43 (13)

To export CSVs: python fetch_lol_series_v3.py --export --run latest
```

## Fields Not Available in GRID Open Access API

These fields are in the hackathon schema but not available:

```
- tournament_id (series) - Not in API response
- gold_earned (player stats) - Not exposed in Open Access
- cs / creep score (player stats) - Not exposed in Open Access
```

## Extending This Skill

### Adding New Output Fields
1. Check if field exists in GRID API schema for target version
2. Add field to appropriate query in `QUERIES` dict
3. Update `extract_and_export()` to capture the new field
4. Add column to the appropriate CSV fieldnames list